using AltV.Net;
using AltV.Net.Elements.Entities;

namespace Controller.Controller.Base.Vehicle;

public class VehicleController : IScript
{
    private static readonly uint[] _excludeCollisionProps =
    [
        4217573666,
        3345732523,
        2029303486,
        1800641404,
        3654973172,
        4293673471,
        840050250,
        609684180,
        1452666705,
        1191039009,
        2034218148,
        1803721002,
        2646441375,
        2377637268,
        2687042166,
        3529959153,
        3295988493,
        4138610559,
        3899069169,
        432141734,
        193190186,
        3806267289,
        4045186068,
        4285808835,
        768318833,
        966571283,
        1205227910,
        1445490218,
        1685785295,
        1963305956,
        2202814577,
        3830972543,
        4161841136,
        156945028,
        455110159,
        2572872310,
        730828513,
        1053734239,
        3120158576,
        1347016789,
        3530316956,
        1707967324,
        2012751793,
        2301708835,
        133449643,
        422144533,
        2876116640,
        3177067136,
        1081686200,
        1393352159,
        3859612637,
        4135167158,
        1977951119,
        2276575016,
        2573724308,
        729058991,
        2923336773,
        3237591483,
        1887651104,
        2194303406,
        1502931467,
        3963588462,
        219009290,
        532969079,
        2643325436,
        793482617,
        1144831835,
        1392401630,
        3351332454,
        3666045930,
        1797524777,
        2380616363,
        3712774532,
        3146591750,
        2176137811,
        1868764591,
        133285582,
        4122485339,
        2827651073,
        442297252,
        995405207,
        688785674,
        4025063102,
        1566503339,
        1983816554,
        1944821444,
        2541411704,
        2798509724,
        2496871079,
        2204964827,
        1898279756,
        3723971826,
        3415648305,
        3125052813,
        2820464954,
        843019649,
        539480402,
        282735287,
        4004114007,
        1822452318,
        1509115140,
        1212260769,
        1165990941,
        2840028075,
        2747390112,
        3497636143,
        3175779025,
        2479776737,
        1762201175,
        3197876335,
        240277467,
        3561055162,
        2961841228,
        1999907185,
        3320760085,
        3236099141,
        3530712543,
        1211452612,
        1441261609,
        749704633,
        979185940,
        284941906,
        2285696557,
        3019328929,
        1638934804,
        2881961281,
        2586089980,
        123499626,
        1437508529,
        1614656839,
        4164154385,
        4201147406,
        1329570871,
        1143474856,
        4066370557,
        3826337632,
        2868958492,
        3107680657,
        3198190107,
        3881769092,
        2464174121,
        3965551402,
        3953524871,
        1792999139,
        2198842852,
        234941195,
        4289023572,
        1919238784,
        2354728673,
        2108567945,
        856312526,
        1138027619,
        258835349,
        2582747295,
        1167668471,
        2879667204,
        4242234993,
        143291855,
        1735046030,
        3082998853,
        3828395012,
        3919353371,
        2613637989,
        897494494,
        1948359883,
        600967813,
        1388308576,
        1098827230,
        1813879595,
        1388415578,
        1627301588,
        2787492567,
        1142865108,
        406416082,
        242636620,
        627816582,
        4158184801,
        2703851248,
        1801655140,
        1682183567,
        939377219,
        1245865676,
        862664990,
        93871477,
        3760607069,
        3235319999,
        4221634134,
        3258159972,
        1839621839,
        1008436154,
        10928689,
        4071695942,
        1866775124,
        4075260498,
        93794225,
        1322893877,
        3116800021,
        3422567560,
        373936410,
        940495467,
        238110203
    ];

    public VehicleController()
    {
        Alt.OnVehicleDamage += OnVehicleDamage;
    }

    public static void OnVehicleDamage(IVehicle target, IEntity attacker, uint bodyHealthDamage,
        uint additionalBodyHealthDamage, uint engineHealthDamage, uint petrolTankDamage, uint weaponHash)
    {
        int damage = bodyHealthDamage switch
        {
            <= 25 => (int)bodyHealthDamage,
            <= 40 => (int)bodyHealthDamage * 4,
            >= 40 => (int)(bodyHealthDamage * 13.7)
        };

        if (target.EngineHealth - damage <= 0) target.EngineHealth = 0;
        else target.EngineHealth -= damage;
        if (damage >= 1200) target.EngineHealth = -300;
        if (target.EngineHealth <= 50) target.EngineOn = false;
    }
}